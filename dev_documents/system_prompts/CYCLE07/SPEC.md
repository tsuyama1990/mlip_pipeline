# Cycle 07 Specification: Advanced Dynamics (The Time-Traveler - kMC)

## 1. Summary

In this cycle, we implement the **Advanced Dynamics** capabilities, specifically focusing on the integration of **EON** for Adaptive Kinetic Monte Carlo (aKMC) simulations and specialized logic for simulating deposition and ordering processes. This component addresses the "Time-Scale Problem" inherent in standard MD.

While MD can simulate picoseconds to nanoseconds, many physical processes (like diffusion, phase ordering, and crystal growth) occur on timescales of seconds to hours. EON allows us to explore these rare events by finding saddle points on the potential energy surface and evolving the system through a sequence of discrete state transitions.

We also implement a dedicated **Deposition Module** within the LAMMPS driver to simulate the growth of thin films (e.g., Fe/Pt on MgO) by periodically inserting atoms into the simulation box. This, combined with aKMC, enables the full "Deposition & Ordering" workflow.

## 2. System Architecture

The following file structure will be created/modified. Files in **bold** are the specific deliverables for this cycle.

```ascii
src/mlip_pipeline/
├── components/
│   ├── dynamics/
│   │   ├── **eon.py**              # EON Wrapper (Client/Server)
│   │   ├── **lammps_deposition.py** # Specialized MD for Deposition
│   │   └── **eon_driver_template.py** # Python script for EON to call Pace
│   └── base.py                     # (Modified) Add kMC support
```

## 3. Design Architecture

### 3.1. EON Integration
Located in `src/mlip_pipeline/components/dynamics/eon.py`.

*   **Config**: `EONDynamicsConfig`.
    *   `temperature`: Float.
    *   `process_search_method`: Enum ("dimer", "neb").
*   **Logic**:
    1.  **Setup**: Create `config.ini` for EON.
    2.  **Driver Generation**: Write a `pace_driver.py` script into the EON working directory. This script acts as the interface between EON (which calls external potentials via CLI or Python) and our `Potential` object.
    3.  **Execution**: Run `eonclient` (and potentially `eonserver` if needed, though client-only mode is often sufficient for local exploration).
    4.  **Parsing**: Read `results.dat` or `processes.dat` to extract the KMC trajectory.

### 3.2. EON Driver Script
Located in `src/mlip_pipeline/components/dynamics/eon_driver_template.py`.
*   This is a standalone Python script generated by the system.
*   It imports `pyacemaker` (or minimal dependencies).
*   It loads the `.yace` potential.
*   It reads coordinates from EON (stdin or file).
*   It computes Energy and Forces.
*   *Crucially*, it also checks **Uncertainty**. If $\gamma > \text{threshold}$, it exits with a special status code to trigger an OTF halt in the Orchestrator.

### 3.3. Deposition Logic
Located in `src/mlip_pipeline/components/dynamics/lammps_deposition.py`.
*   **Config**: `DepositionConfig`.
    *   `species`: List[str] (e.g., ["Fe", "Pt"]).
    *   `rate`: Float (Atoms per nanosecond).
    *   `temperature`: Float.
*   **Logic**:
    *   Use LAMMPS `fix deposit` command.
    *   Carefully set the `region` for insertion (above the substrate).
    *   Use `fix nvt` or `fix nve` + `fix langevin` for temperature control.
    *   Output a trajectory showing the growth of the film.

## 4. Implementation Approach

1.  **Driver Template**: Create the `pace_driver.py` template string. It must be self-contained and robust.
2.  **EON Wrapper**: Implement the `run_kmc` method in `EONDynamics`. Ensure it handles the EON directory structure correctly.
3.  **Deposition**: Implement `run_deposition` in `LAMMPSDynamics` (or a subclass). This requires constructing a complex LAMMPS input script with regions, groups, and variable loops.

## 5. Test Strategy

### 5.1. Unit Testing
*   **Driver Generation**: Generate `pace_driver.py`. Execute it with a dummy structure input (via stdin). Assert it prints energy and forces in the format EON expects.
*   **Deposition Input**: Verify the generated `in.lammps` contains `fix deposit ... region ... near ...`.

### 5.2. Integration Testing
*   **Mock EON**: Create a "Mock EON" that just calls the driver script once and exits. This tests the Python-Python interface.
*   **Short Deposition**: Run a deposition of 5 atoms on a flat surface (LJ potential). Visualize the trajectory to ensure atoms appear and stick.

### 5.3. Scientific Validation
*   **Ordering**: Use a small 2-element cluster (Fe-Pt). Run aKMC starting from a high-energy disordered state. Assert that the energy decreases over time and the number of Fe-Pt bonds increases (ordering).
