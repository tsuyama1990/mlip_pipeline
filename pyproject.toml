[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "mlip_autopipec"
version = "0.1.0"
authors = [
  { name="AI SWE", email="author@example.com" },
]
description = "Automated Machine Learning Interatomic Potential Pipeline"
readme = "README.md"
requires-python = ">=3.11"
classifiers = [
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
dependencies = [
    "pydantic",
    "numpy",
    "scipy>=1.17.0",
    "scikit-learn>=1.8.0",
    "pandas",
    "numba>=0.59.0",
    "ase>=3.22.1",
    "mace-torch",
    "dscribe>=2.1.0",
    "torch>=2.0.0",
    "typer",
    "rich",
    "pyyaml",
    "dask>=2023.1.0",
    "distributed",
    "tenacity>=9.1.2",
    "plotly",
    "matplotlib",
    "Jinja2",
    "phonopy>=2.20.0",
]

[project.urls]
"Homepage" = "https://github.com/pypa/sampleproject"
"Bug Tracker" = "https://github.com/pypa/sampleproject/issues"

[project.optional-dependencies]
dev = [
    "pytest",
    "pytest-cov>=7.0.0",
    "dask[distributed]",
    "mypy",
    "pytest-mock",
    "types-pyyaml>=6.0.12.20250915",
    "ruff",
]

[tool.setuptools]
package-dir = {"" = "src"}

[tool.setuptools.packages.find]
where = ["src"]

[project.scripts]
mlip-auto = "mlip_autopipec.app:app"

[tool.ruff]
target-version = "py311"
line-length = 100
fix = true

[tool.ruff.lint]
# E/F/I: Basic, B: Bugbear, S: Bandit, UP: pyupgrade
select = [
    "F",    # Pyflakes (basic errors)
    "E", "W", # pycodestyle (style)
    "C90",  # mccabe (complexity check: prevent AI spaghetti code)
    "I",    # isort (import organization)
    "N",    # pep8-naming (naming conventions: proper class/function names)
    "UP",   # pyupgrade (modern syntax)
    "YTT",  # flake8-2020 (prevent sys.version misuse)
    "ANN",  # flake8-annotations (enforce type hints: critical)
    "ASYNC",# flake8-async (prevent async bugs)
    "S",    # flake8-bandit (security)
    "BLE",  # flake8-blind-except (prohibit catching all errors)
    "B",    # flake8-bugbear (detect bug hotspots)
    "A",    # flake8-builtins (prevent overwriting built-in names: id, list, etc.)
    "C4",   # flake8-comprehensions (optimize list comprehensions)
    "DTZ",  # flake8-datetimez (enforce timezone)
    "T10",  # flake8-debugger (prevent forgotten debugger statements)
    "EM",   # flake8-errmsg (improve exception message quality)
    "ICN",  # flake8-import-conventions (standardize import aliases: pd, np, etc.)
    "PIE",  # flake8-pie (miscellaneous code improvements)
    "T20",  # flake8-print (prohibit print statements: enforce logger usage)
    "PT",   # flake8-pytest-style (improve test code quality)
    "RET",  # flake8-return (return statement consistency)
    "SIM",  # flake8-simplify (concise writing)
    "TID",  # flake8-tidy-imports (organize imports)
    "ARG",  # flake8-unused-arguments (remove unused arguments)
    "PTH",  # flake8-use-pathlib (prohibit os.path -> enforce pathlib)
    "ERA",  # eradicate (remove commented code: clean up AI trial-and-error traces)
    "PL",   # Pylint (comprehensive code quality checks)
    "TRY",  # tryceratops (proper exception handling)
    "RUF",  # Ruff-specific rules
]

ignore = [
    "ANN101", # Type hint for self is unnecessary (deprecated)
    "ANN002", # Type hint for *args can be omitted
    "ANN003", # Type hint for **kwargs can be omitted
    "ANN001", # Missing type annotation for function arguments
    "ANN401", # Dynamically typed expressions are disallowed
    "ARG001", # Unused function argument
    "ARG005", # Unused lambda argument
    "PLR2004", # Magic value used in comparison
    "E501",   # Line length limit (auto-fix may not work, slows development)
    "TRY003", # Exception message too long warning (too strict for AI)
    "D",      # docstring (excluded to focus on code behavior risks. Add if needed)
    "ANN201", # Missing return type annotation for public functions
    "N806",   # Variable should be lowercase
    "PLC0415", # Import should be at top-level
    "BLE001", # Blind exception catch
    "PT019",  # Fixture without value injection
    "RUF003", # Ambiguous multiplication sign
    "ARG002", # Unused method argument
    "RUF043", # Pattern metacharacters not escaped in match
    "RUF059", # Unused unpacked variable
    "PLR0913", # Too many arguments in function definition
    "ANN202", # Missing return type annotation for private functions
    "ERA001", # Found commented-out code (too many false positives with math/formulas)
    "TRY301", # Abstract `raise` to an inner function (overkill for simple raises)
    "TRY300", # Consider moving this statement to an `else` block
    "RET504", # Unnecessary assignment to `resolved` before `return` statement
    "SIM117", # Use a single `with` statement with multiple contexts
    "RUF012", # Mutable class attributes should be annotated with `typing.ClassVar`
    "S603",   # `subprocess` call: check for execution of untrusted input (we validate inputs)
    "TRY401", # Redundant exception object included in `logging.exception` call
    "TRY002", # Create your own exception
    "ANN204", # Missing return type annotation for special method `__init__`
    "C901",   # mccabe: function is too complex
    "PLR0915", # Too many statements
    "PLR0912", # Too many branches
    "PLR0911", # Too many return statements
    "S311",   # Standard pseudo-random generators are not suitable for cryptographic purposes (we use them for shuffling)
    "S701",   # By default, jinja2 sets `autoescape` to `False` (internal dashboard, low risk)
    "S110",   # `try`-`except`-`pass` detected
    "PLW1510", # `subprocess.run` without explicit `check` argument
    "TRY004", # Prefer `TypeError` exception for invalid type
    "B904",   # Within an `except` clause, raise exceptions with `raise ... from err`
    "A002",   # Function argument `id` is shadowing a Python builtin
    "PTH123", # `open()` should be replaced by `Path.open()`
    "PTH100", # `os.path.abspath()` should be replaced by `Path.resolve()`
    "SIM115"  # Use context handler for opening files
]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = ["S101"]  # Allow assert in tests

[tool.ruff.lint.mccabe]
max-complexity = 10  # Exceeding this prompts function splitting (prevent AI long functions)

[tool.ruff.lint.flake8-annotations]
suppress-dummy-args = true  # Arguments starting with _ do not require type hints

[tool.pytest.ini_options]
addopts = ""
testpaths = ["tests"]

[tool.mypy]
strict = false
ignore_missing_imports = true
disallow_untyped_defs = false
disallow_subclassing_any = false

[[tool.mypy.overrides]]
module = "tests.*"
strict = false
disallow_untyped_defs = false
disallow_untyped_decorators = false
check_untyped_defs = false

[[tool.mypy.overrides]]
module = "mlip_autopipec.app"
disallow_untyped_decorators = false

[[tool.mypy.overrides]]
module = ["yaml", "ase.*", "dask.*", "spglib"]
ignore_missing_imports = true

[dependency-groups]
dev = [
    "mypy>=1.19.1",
    "pytest>=9.0.2",
    "pytest-cov>=7.0.0",
    "ruff>=0.14.14",
]
